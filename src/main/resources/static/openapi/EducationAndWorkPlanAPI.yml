openapi: 3.0.0
info:
  title: Education and Work Plan API
  version: '1.1.6'
  description: Education and Work Plan API
  contact:
    name: Matt Wills
    email: matt.wills@digital.justice.gov.uk
servers:
  - url: 'http://localhost:3000'
#
# --------------------------------------------------------------------------------
#
paths:
  #
  # --------------------------------------------------------------------------------
  # RESTful style endpoints start here
  # --------------------------------------------------------------------------------
  #

  #
  # Action Plans
  # --------------------------------------------------------------------------------
  '/action-plans/':
    post:
      summary: Retrieves a list of Action Plans for a given list of Prisoners.
      description: Retrieves a list of Action Plans for a given list of Prisoners.
      tags:
        - Action Plan
      responses:
        '201':
          $ref: '#/components/responses/ActionPlanSummaryList'
        '400':
          $ref: '#/components/responses/400ErrorResponse'
        '404':
          $ref: '#/components/responses/404ErrorResponse'
      operationId: get-action-plans
      requestBody:
        $ref: '#/components/requestBodies/GetActionPlanSummaries'

  '/action-plans/{prisonNumber}':
    parameters:
      - name: prisonNumber
        description: The number of the Prisoner who may have created (or is in the process of creating) an "Action Plan", consisting of one or more Goals. The prisonNumber is the unique identifier of the Action Plan.
        schema:
          type: string
        example: 'A1234BC'
        in: path
        required: true
    post:
      summary: Creates an Action Plan.
      description: Creates an Action Plan with at least one or more Goals.
      tags:
        - Action Plan
      responses:
        '201':
          description: The Action Plan was created successfully.
        '400':
          $ref: '#/components/responses/400ErrorResponse'
        '404':
          $ref: '#/components/responses/404ErrorResponse'
      operationId: create-action-plan
      requestBody:
        $ref: '#/components/requestBodies/CreateActionPlan'
    get:
      summary: Return a Prisoner's Action Plan
      description: Return a Prisoner's Action Plan with the goals ordered in chronological order (oldest first). If the prisoner does not yet have any goals set, then an Action Plan with no goals (empty array) is returned.
      tags:
        - Action Plan
      responses:
        '200':
          $ref: '#/components/responses/ActionPlan'
      operationId: get-action-plan-by-prison-number

  #
  # Action Plans
  # --------------------------------------------------------------------------------
  '/action-plans/{prisonNumber}/goals':
    parameters:
      - name: prisonNumber
        description: The number of the Prisoner who may have created (or is in the process of creating) an "Action Plan", consisting of one or more Goals. The prisonNumber is the unique identifier of the Action Plan.
        schema:
          type: string
        example: 'A1234BC'
        in: path
        required: true
    post:
      summary: Creates a Goal.
      description: Creates a Goal and saves it to the Prisoner's Action Plan (the latter will be created if it doesn't already exist).
      tags:
        - Action Plan - Single Goal
      responses:
        '201':
          description: The Goal was created successfully.
        '400':
          $ref: '#/components/responses/400ErrorResponse'
        '404':
          $ref: '#/components/responses/404ErrorResponse'
      operationId: create-goal
      requestBody:
        $ref: '#/components/requestBodies/CreateGoal'

  '/action-plans/{prisonNumber}/goals/{goalReference}':
    parameters:
      - name: prisonNumber
        description: The number of the Prisoner who owns the Goal.
        schema:
          type: string
        example: 'A1234BC'
        in: path
        required: true
      - name: goalReference
        description: The Goal's unique reference
        schema:
          type: string
          format: uuid
        example: 'c88a6c48-97e2-4c04-93b5-98619966447b'
        in: path
        required: true
    put:
      summary: Updates a Goal
      description: Updates a single Goal and its list of Steps (including their sequential order if relevant). Note that the whole of a Goal's data should be provided, otherwise the absence of any data (such as a Step) will result in it being removed.
      tags:
        - Action Plan - Single Goal
      responses:
        '204':
          description: The Goal was updated successfully.
        '400':
          $ref: '#/components/responses/400ErrorResponse'
        '404':
          $ref: '#/components/responses/404ErrorResponse'
      operationId: update-goal
      requestBody:
        $ref: '#/components/requestBodies/UpdateGoal'
#
# --------------------------------------------------------------------------------
#
components:
  #
  # Schema and Enum Definitions
  # --------------------------------------------------------------------------------
  schemas:
    ErrorResponse:
      title: ErrorResponse
      description: |
        A generic response body object describing errors in a web request, and can be used to communicate several
        different types of error condition such as (but not limited to) `400 BAD REQUEST`, `409 CONFLICT` etc.
      properties:
        status:
          description: The HTTP status code.
          type: integer
          example: 400
        errorCode:
          description: An optional application specific error code.
          type: string
        userMessage:
          description: An optional human readable description of the error.
          type: string
          example: 'No Action Plan found for prisoner [A1234BC]'
        developerMessage:
          description: An optional error message that may have more technical information for developers.
          type: string
        moreInfo:
          description: Optional more detailed information about the error.
          type: string
      required:
        - status
    ActionPlanSummaryListResponse:
      title: ActionPlanSummaryListResponse
      type: object
      description: Contains a list of Action Plan summaries.
      properties:
        summaries:
          type: array
          description: A List of prisoners' Action Plan summaries. Can be empty but not null.
          items:
            $ref: '#/components/schemas/ActionPlanSummaryResponse'
      required:
        - summaries
    ActionPlanSummaryResponse:
      title: ActionPlanSummaryResponse
      type: object
      description: A subset of data regarding a prisoner's Action plan.
      properties:
        reference:
          type: string
          format: uuid
          description: The Action Plan's unique reference
          example: 814ade0a-a3b2-46a3-862f-79211ba13f7b
        prisonNumber:
          type: string
          description: The ID of the prisoner
          example: 'A1234BC'
        reviewDate:
          type: string
          format: date
          description: An optional ISO-8601 date representing when the Action Plan is up for review.
          example: '2024-12-19'
      required:
        - reference
        - prisonNumber
    ActionPlanResponse:
      title: ActionPlanResponse
      type: object
      description: A Prisoner's Action Plan containing a list of one or more Goals.
      properties:
        reference:
          type: string
          format: uuid
          description: The Action Plan's unique reference
          example: 814ade0a-a3b2-46a3-862f-79211ba13f7b
        prisonNumber:
          type: string
          description: The ID of the prisoner
          example: 'A1234BC'
        reviewDate:
          type: string
          format: date
          description: An optional ISO-8601 date representing when the Action Plan is up for review.
          example: '2024-12-19'
        goals:
          type: array
          description: A List of at least one or more Goals.
          items:
            $ref: '#/components/schemas/GoalResponse'
      required:
        - reference
        - prisonNumber
        - goals
    GoalResponse:
      title: GoalResponse
      type: object
      description: An individual Goal that a Prisoner aims to complete as part of their Action Plan. The goal will be active to start with.
      properties:
        goalReference:
          type: string
          format: uuid
          description: The Goal's unique reference
          example: c88a6c48-97e2-4c04-93b5-98619966447b
        title:
          type: string
          description: A title explaining the aim of the goal.
          example: Improve communication skills
        reviewDate:
          type: string
          format: date
          description: An optional ISO-8601 date representing when the Goal is up for review.
          example: '2023-12-19'
        status:
          $ref: '#/components/schemas/GoalStatus'
        steps:
          type: array
          minItems: 1
          description: A List of at least one Step.
          items:
            $ref: '#/components/schemas/StepResponse'
        notes:
          type: string
          description: Some additional notes related to the Goal.
          example: Pay close attention to Peter's behaviour.
        createdBy:
          type: string
          description: The DPS username of the person who created the goal.
          example: 'asmith_gen'
        createdByDisplayName:
          type: string
          description: The display name of the person who created the goal.
          example: 'Alex Smith'
        createdAt:
          type: string
          format: date-time
          description: An ISO-8601 timestamp representing when the Goal was created.
          example: '2023-06-19T09:39:44Z'
        updatedBy:
          type: string
          description: The DPS username of the person who last updated the goal.
          example: 'asmith_gen'
        updatedByDisplayName:
          type: string
          description: The display name of the person who last updated the goal.
          example: 'Alex Smith'
        updatedAt:
          type: string
          format: date-time
          description: An ISO-8601 timestamp representing when the Goal was last updated. This will be the same as the created date if it has not yet been updated.
          example: '2023-06-19T09:39:44Z'
      required:
        - goalReference
        - title
        - status
        - steps
        - createdBy
        - createdByDisplayName
        - createdAt
        - updatedBy
        - updatedByDisplayName
        - updatedAt
    StepResponse:
      title: StepResponse
      type: object
      description: A Step within a Goal that must be completed in order for the overall Goal to be completed.
      properties:
        stepReference:
          type: string
          format: uuid
          description: A unique reference for the Step
          example: d38a6c41-13d1-1d05-13c2-24619966119b
        title:
          type: string
          description: A title describing the step
          example: Book communication skills course
        targetDateRange:
          $ref: '#/components/schemas/TargetDateRange'
        status:
          $ref: '#/components/schemas/StepStatus'
        sequenceNumber:
          type: integer
          description: The number (position) of the Step within the overall Goal.
          example: 1
      required:
        - stepReference
        - title
        - targetDateRange
        - status
        - sequenceNumber

    GetActionPlanSummariesRequest:
      title: GetActionPlanSummariesRequest
      type: object
      description: A request to retrieve a list of Action Plan summaries for at least one prisoner.
      properties:
        prisonNumbers:
          type: array
          description: A List of at least one prison number.
          minItems: 1
          items:
            type: string
      required:
        - prisonNumbers

    CreateActionPlanRequest:
      title: CreateActionPlanRequest
      type: object
      description: A request to create an Action Plan with at least one or more Goals that a Prisoner aims to complete.
      properties:
        reviewDate:
          type: string
          format: date
          x-constraints: 'NotInPast'
          description: An optional ISO-8601 date representing when the Action Plan is up for review.
          example: '2023-12-19'
        goals:
          type: array
          minItems: 1
          description: A List of at least one Goal.
          items:
            $ref: '#/components/schemas/CreateGoalRequest'
      required:
        - goals

    CreateGoalRequest:
      title: CreateGoalRequest
      type: object
      description: A request to create an individual Goal that a Prisoner aims to complete as part of their Action Plan. The goal's status will be set to 'ACTIVE'.
      properties:
        title:
          type: string
          description: A title explaining the aim of the goal.
          example: Improve communication skills
        reviewDate:
          type: string
          format: date
          x-constraints: 'NotInPast'
          description: An optional ISO-8601 date representing when the Goal is up for review.
          example: '2023-12-19'
        steps:
          type: array
          minItems: 1
          description: A List of at least one Step.
          items:
            $ref: '#/components/schemas/CreateStepRequest'
        notes:
          type: string
          description: Some additional notes related to the Goal.
          example: Pay close attention to Peter's behaviour.
      required:
        - title
        - steps

    UpdateGoalRequest:
      title: UpdateGoalRequest
      type: object
      description: A request to update an individual Goal that a Prisoner aims to complete as part of their Action Plan.
      properties:
        goalReference:
          type: string
          format: uuid
          description: The Goal's unique reference. This is used as an identifier to update the required Goal. It is not possible or supported to update the `goalReference`.
          example: c88a6c48-97e2-4c04-93b5-98619966447b
        title:
          type: string
          description: A title explaining the aim of the goal.
          example: Improve communication skills
        reviewDate:
          type: string
          format: date
          description: An optional ISO-8601 date representing when the Goal is up for review.
          example: '2023-12-19'
        status:
          $ref: '#/components/schemas/GoalStatus'
        steps:
          type: array
          minItems: 1
          description: A List of at least one Step.
          items:
            $ref: '#/components/schemas/UpdateStepRequest'
        notes:
          type: string
          description: Some additional notes related to the Goal.
          example: Pay close attention to Peter's behaviour.
      required:
        - goalReference
        - title
        - status
        - steps

    CreateStepRequest:
      title: CreateStepRequest
      type: object
      description: A request to create a Step within a Goal. Note that new Steps are created with an implicit status of NOT_STARTED.
      properties:
        title:
          type: string
          description: A title describing the step
          example: Book first aid course
        targetDateRange:
          $ref: '#/components/schemas/TargetDateRange'
        sequenceNumber:
          type: integer
          description: The number (position) of the Step within the overall Goal.
          example: 1
      required:
        - title
        - targetDateRange
        - sequenceNumber

    UpdateStepRequest:
      title: UpdateStepRequest
      type: object
      description: A request to update a Step within a Goal.
      allOf:
        - $ref: '#/components/schemas/CreateStepRequest'
      properties:
        stepReference:
          type: string
          format: uuid
          description: |
            Optional reference number for the Step.
            The Step's unique reference. This is used as an identifier to update the required Step. It is not possible or supported to update the `stepReference` for an existing step.
            If the Step reference is not supplied this will be treated as a new Step and will be added to the Goal.
          example: d38a6c41-13d1-1d05-13c2-24619966119b
        status:
          $ref: '#/components/schemas/StepStatus'
      required:
        - status

    GoalStatus:
      title: GoalStatus
      description: Enum describing the various statuses of a Goal's lifecycle.
      type: string
      enum:
        - ACTIVE
        - COMPLETED
        - ARCHIVED
    StepStatus:
      title: StepStatus
      description: Enum describing the various statuses of a Step's lifecycle.
      type: string
      enum:
        - NOT_STARTED
        - ACTIVE
        - COMPLETE
    TargetDateRange:
      title: TargetDateRange
      description: An enumerated set of date ranges, representing a target period for the step to be completed by.
      type: string
      enum:
        - ZERO_TO_THREE_MONTHS
        - THREE_TO_SIX_MONTHS
        - SIX_TO_TWELVE_MONTHS
        - MORE_THAN_TWELVE_MONTHS

  #
  # Response Body Definitions
  # --------------------------------------------------------------------------------
  responses:
    400ErrorResponse:
      description: Error response for a HTTP 400 describing fields in the request payload that are in error.
      headers:
        Access-Control-Allow-Origin:
          schema:
            type: string
        Access-Control-Allow-Methods:
          schema:
            type: string
        Access-Control-Allow-Headers:
          schema:
            type: string
      content:
        application/json:
          schema:
            $ref: '#/components/schemas/ErrorResponse'
          example:
            status: 400
            userMessage: 'Error on field goal.reviewDate: rejected value [2023-06-01] cannot be in the past'
    404ErrorResponse:
      description: |
        Error response for a HTTP 404 describing the problem with the request.
      headers:
        Access-Control-Allow-Origin:
          schema:
            type: string
        Access-Control-Allow-Methods:
          schema:
            type: string
        Access-Control-Allow-Headers:
          schema:
            type: string
      content:
        application/json:
          schema:
            $ref: '#/components/schemas/ErrorResponse'
          example:
            status: 404
            userMessage: 'The prisoner with prisonNumber=[A1234BC] not found'
    409ErrorResponse:
      description: |
        Error response for a HTTP 409 describing the problem with the request.
      headers:
        Access-Control-Allow-Origin:
          schema:
            type: string
        Access-Control-Allow-Methods:
          schema:
            type: string
        Access-Control-Allow-Headers:
          schema:
            type: string
      content:
        application/json:
          schema:
            $ref: '#/components/schemas/ErrorResponse'
          example:
            status: 409
            userMessage: 'A Goal with reference [c88a6c48-97e2-4c04-93b5-98619966447b] has an unexpected status = ARCHIVED'
    ActionPlanSummaryList:
      description: Response body containing the a list of Action Plan summaries that make up a Prisoner's Action Plan.
      headers:
        Access-Control-Allow-Origin:
          schema:
            type: string
        Access-Control-Allow-Methods:
          schema:
            type: string
        Access-Control-Allow-Headers:
          schema:
            type: string
      content:
        application/json:
          schema:
            $ref: '#/components/schemas/ActionPlanSummaryListResponse'
    ActionPlan:
      description: Response body containing the Goals that make up a Prisoner's Action Plan.
      headers:
        Access-Control-Allow-Origin:
          schema:
            type: string
        Access-Control-Allow-Methods:
          schema:
            type: string
        Access-Control-Allow-Headers:
          schema:
            type: string
      content:
        application/json:
          schema:
            $ref: '#/components/schemas/ActionPlanResponse'
    Goal:
      description: Response body containing a single Goal within a Prisoner's Action Plan.
      headers:
        Access-Control-Allow-Origin:
          schema:
            type: string
        Access-Control-Allow-Methods:
          schema:
            type: string
        Access-Control-Allow-Headers:
          schema:
            type: string
      content:
        application/json:
          schema:
            $ref: '#/components/schemas/GoalResponse'

  #
  # Request Body Definitions
  # --------------------------------------------------------------------------------
  requestBodies:
    GetActionPlanSummaries:
      description: Request body to retrieve a list of Action Plan summaries for one or more Prisoners.
      content:
        application/json:
          schema:
            $ref: '#/components/schemas/GetActionPlanSummariesRequest'
    CreateActionPlan:
      description: Request body to create an Action Plan with at least one or more Goals.
      content:
        application/json:
          schema:
            $ref: '#/components/schemas/CreateActionPlanRequest'
    CreateGoal:
      description: Request body to create a single Goal.
      content:
        application/json:
          schema:
            $ref: '#/components/schemas/CreateGoalRequest'
    UpdateGoal:
      description: Request body to update a single Goal.
      content:
        application/json:
          schema:
            $ref: '#/components/schemas/UpdateGoalRequest'
